!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],e);else{var r="object"==typeof exports?e(require("THREE")):e(t.THREE);for(var i in r)("object"==typeof exports?exports:t)[i]=r[i]}}(window,function(t){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=47)}([function(e,r){e.exports=t},function(t,e){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,e,r){var i=r(8),n=r(19);t.exports=r(4)?function(t,e,r){return i.f(t,e,n(1,r))}:function(t,e,r){return t[e]=r,t}},function(t,e,r){var i=r(15)("wks"),n=r(7),o=r(1).Symbol,a="function"==typeof o;(t.exports=function(t){return i[t]||(i[t]=a&&o[t]||(a?o:n)("Symbol."+t))}).store=i},function(t,e,r){t.exports=!r(17)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){var r={}.hasOwnProperty;t.exports=function(t,e){return r.call(t,e)}},function(t,e){var r=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=r)},function(t,e){var r=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+i).toString(36))}},function(t,e,r){var i=r(9),n=r(28),o=r(29),a=Object.defineProperty;e.f=r(4)?Object.defineProperty:function(t,e,r){if(i(t),e=o(e,!0),i(r),n)try{return a(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},function(t,e,r){var i=r(10);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports={}},function(t,e,r){var i=r(31),n=r(20);t.exports=function(t){return i(n(t))}},function(t,e,r){var i=r(1),n=r(2),o=r(5),a=r(7)("src"),s=Function.toString,u=(""+s).split("toString");r(6).inspectSource=function(t){return s.call(t)},(t.exports=function(t,e,r,s){var l="function"==typeof r;l&&(o(r,"name")||n(r,"name",e)),t[e]!==r&&(l&&(o(r,a)||n(r,a,t[e]?""+t[e]:u.join(String(e)))),t===i?t[e]=r:s?t[e]?t[e]=r:n(t,e,r):(delete t[e],n(t,e,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||s.call(this)})},function(t,e,r){var i=r(15)("keys"),n=r(7);t.exports=function(t){return i[t]||(i[t]=n(t))}},function(t,e,r){var i=r(6),n=r(1),o=n["__core-js_shared__"]||(n["__core-js_shared__"]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:r(16)?"pure":"global",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports=!1},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,r){var i=r(10),n=r(1).document,o=i(n)&&i(n.createElement);t.exports=function(t){return o?n.createElement(t):{}}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,r){var i=r(40),n=r(23);t.exports=Object.keys||function(t){return i(t,n)}},function(t,e){var r=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:r)(t)}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,r){var i=r(8).f,n=r(5),o=r(3)("toStringTag");t.exports=function(t,e,r){t&&!n(t=r?t:t.prototype,o)&&i(t,o,{configurable:!0,value:e})}},function(t,e,r){for(var i=r(26),n=r(21),o=r(13),a=r(1),s=r(2),u=r(11),l=r(3),c=l("iterator"),h=l("toStringTag"),f=u.Array,d={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=n(d),m=0;m<p.length;m++){var v,g=p[m],y=d[g],x=a[g],b=x&&x.prototype;if(b&&(b[c]||s(b,c,f),b[h]||s(b,h,g),u[g]=f,y))for(v in i)b[v]||o(b,v,i[v],!0)}},function(t,e,r){"use strict";var i=r(27),n=r(30),o=r(11),a=r(12);t.exports=r(33)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,n(1)):n(0,"keys"==e?r:"values"==e?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(t,e,r){var i=r(3)("unscopables"),n=Array.prototype;void 0==n[i]&&r(2)(n,i,{}),t.exports=function(t){n[i][t]=!0}},function(t,e,r){t.exports=!r(4)&&!r(17)(function(){return 7!=Object.defineProperty(r(18)("div"),"a",{get:function(){return 7}}).a})},function(t,e,r){var i=r(10);t.exports=function(t,e){if(!i(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!i(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!i(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!i(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,r){var i=r(32);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,e,r){"use strict";var i=r(16),n=r(34),o=r(13),a=r(2),s=r(11),u=r(37),l=r(24),c=r(45),h=r(3)("iterator"),f=!([].keys&&"next"in[].keys()),d=function(){return this};t.exports=function(t,e,r,p,m,v,g){u(r,e,p);var y,x,b,S=function(t){if(!f&&t in P)return P[t];switch(t){case"keys":case"values":return function(){return new r(this,t)}}return function(){return new r(this,t)}},w=e+" Iterator",T="values"==m,M=!1,P=t.prototype,C=P[h]||P["@@iterator"]||m&&P[m],B=C||S(m),_=m?T?S("entries"):B:void 0,O="Array"==e&&P.entries||C;if(O&&(b=c(O.call(new t)))!==Object.prototype&&b.next&&(l(b,w,!0),i||"function"==typeof b[h]||a(b,h,d)),T&&C&&"values"!==C.name&&(M=!0,B=function(){return C.call(this)}),i&&!g||!f&&!M&&P[h]||a(P,h,B),s[e]=B,s[w]=d,m)if(y={values:T?B:S("values"),keys:v?B:S("keys"),entries:_},g)for(x in y)x in P||o(P,x,y[x]);else n(n.P+n.F*(f||M),e,y);return y}},function(t,e,r){var i=r(1),n=r(6),o=r(2),a=r(13),s=r(35),u=function(t,e,r){var l,c,h,f,d=t&u.F,p=t&u.G,m=t&u.S,v=t&u.P,g=t&u.B,y=p?i:m?i[e]||(i[e]={}):(i[e]||{}).prototype,x=p?n:n[e]||(n[e]={}),b=x.prototype||(x.prototype={});for(l in p&&(r=e),r)h=((c=!d&&y&&void 0!==y[l])?y:r)[l],f=g&&c?s(h,i):v&&"function"==typeof h?s(Function.call,h):h,y&&a(y,l,h,t&u.U),x[l]!=h&&o(x,l,f),v&&b[l]!=h&&(b[l]=h)};i.core=n,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},function(t,e,r){var i=r(36);t.exports=function(t,e,r){if(i(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,i){return t.call(e,r,i)};case 3:return function(r,i,n){return t.call(e,r,i,n)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,r){"use strict";var i=r(38),n=r(19),o=r(24),a={};r(2)(a,r(3)("iterator"),function(){return this}),t.exports=function(t,e,r){t.prototype=i(a,{next:n(1,r)}),o(t,e+" Iterator")}},function(t,e,r){var i=r(9),n=r(39),o=r(23),a=r(14)("IE_PROTO"),s=function(){},u=function(){var t,e=r(18)("iframe"),i=o.length;for(e.style.display="none",r(44).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;i--;)delete u.prototype[o[i]];return u()};t.exports=Object.create||function(t,e){var r;return null!==t?(s.prototype=i(t),r=new s,s.prototype=null,r[a]=t):r=u(),void 0===e?r:n(r,e)}},function(t,e,r){var i=r(8),n=r(9),o=r(21);t.exports=r(4)?Object.defineProperties:function(t,e){n(t);for(var r,a=o(e),s=a.length,u=0;s>u;)i.f(t,r=a[u++],e[r]);return t}},function(t,e,r){var i=r(5),n=r(12),o=r(41)(!1),a=r(14)("IE_PROTO");t.exports=function(t,e){var r,s=n(t),u=0,l=[];for(r in s)r!=a&&i(s,r)&&l.push(r);for(;e.length>u;)i(s,r=e[u++])&&(~o(l,r)||l.push(r));return l}},function(t,e,r){var i=r(12),n=r(42),o=r(43);t.exports=function(t){return function(e,r,a){var s,u=i(e),l=n(u.length),c=o(a,l);if(t&&r!=r){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((t||c in u)&&u[c]===r)return t||c||0;return!t&&-1}}},function(t,e,r){var i=r(22),n=Math.min;t.exports=function(t){return t>0?n(i(t),9007199254740991):0}},function(t,e,r){var i=r(22),n=Math.max,o=Math.min;t.exports=function(t,e){return(t=i(t))<0?n(t+e,0):o(t,e)}},function(t,e,r){var i=r(1).document;t.exports=i&&i.documentElement},function(t,e,r){var i=r(5),n=r(46),o=r(14)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=n(t),i(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,r){var i=r(20);t.exports=function(t){return Object(i(t))}},function(t,e,r){"use strict";r.r(e);r(25);function i(t,e){return t+(Math.random()-.5)*e}var n=r(0),o=function(){function t(t,e,r,o,a,s,u,l,c){var h,f;this.rotate=360*Math.random(),this.id=Math.random(),this.panelOpacity=.1,this.rotateSpeed=a,this.angle=r,this.speed=o,this.center=e,this.onDelete=c,this.distance=l.startShow,this.showDistance=l,this.panelMaterial=(new n.MeshBasicMaterial).copy(s),this.panelMaterial.transparent=!0,this.lineMaterial=(new n.LineBasicMaterial).copy(u),this.lineMaterial.transparent=!0;var d=new n.Geometry,p=new n.Geometry,m=[new n.Vector3(i(t,t/2),i(t,t/2),0),new n.Vector3(-1*i(t,t/2),i(t,t/2),0),new n.Vector3(-1*i(t,t/2),-1*i(t,t/2),0)];(h=d.vertices).push.apply(h,m),(f=p.vertices).push.apply(f,m.concat([m[0]])),d.faces.push(new n.Face3(0,1,2)),d.computeFaceNormals(),d.computeVertexNormals(),this.line=new n.Line(p,this.lineMaterial),this.mesh=new n.Mesh(d,this.panelMaterial),this.group=new n.Group,this.translateOnAxis(this.translate(this.distance),1),this.group.add(this.line),this.group.add(this.mesh),this.rotateZ(this.rotate),this.updatePosition(0)}return t.prototype.rotateZ=function(t){this.mesh.geometry.rotateZ(t),this.line.geometry.rotateZ(t)},t.prototype.translate=function(t){var e=Math.cos(this.angle*Math.PI/180)*t,r=Math.sin(this.angle*Math.PI/180)*t;return new n.Vector3(e,r,0)},t.prototype.translateOnAxis=function(t,e){this.group.translateOnAxis(t,e)},t.prototype.updatePosition=function(t){this.translateOnAxis(this.translate(t*this.speed),1),this.distance+=t*this.speed,this.rotateZ(this.rotateSpeed*t),this.panelMaterial.opacity=this.opacity(this.distance,this.showDistance)*this.panelOpacity,this.lineMaterial.opacity=this.opacity(this.distance,this.showDistance),this.distance>this.showDistance.endHide&&this.delete()},t.prototype.delete=function(){this.onDelete(this),this.mesh.geometry.dispose(),this.line.geometry.dispose()},t.prototype.opacity=function(t,e){return this.distance<e.endShow?(this.distance-e.startShow)/(e.endShow-e.startShow):this.distance>e.startHide?(e.endHide-this.distance)/(e.endHide-e.startHide):1},t.prototype.transition=function(t){this.updatePosition(t)},t}();function a(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);for(var n=-1,o=Math.max(Math.ceil((e-t)/r),0),a=Array(o);o--;)a[i?o:++n]=t,t+=r;return a}var s=function(){function t(t,e,r){this.lastStrength=0,this.theStrength=0,this.targetRange=0,this._range=0,this.baseRange=t,this.angle=e,this.center=r}return Object.defineProperty(t.prototype,"positionA",{get:function(){var t=this._range+this.baseRange,e=Math.cos(this.angle*Math.PI/180)*t,r=Math.sin(this.angle*Math.PI/180)*t;return new n.Vector2(this.center.x+e,this.center.y+r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionB",{get:function(){var t=-1*this._range+this.baseRange,e=Math.cos(this.angle*Math.PI/180)*t,r=Math.sin(this.angle*Math.PI/180)*t;return new n.Vector2(this.center.x+e,this.center.y+r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strength",{set:function(t){this.lastStrength=this.theStrength,this.theStrength=t,this.targetRange=Math.max(this.theStrength-this.lastStrength,0),this.targetRange>this._range&&(this._range=this.targetRange)},enumerable:!0,configurable:!0}),t.prototype.transition=function(t){this._range=Math.max(this._range-t*this._range*5,0)},t}(),u=function(){function t(t){void 0===t&&(t={}),this.audioElement=null,this.listener=new n.AudioListener,this.sound=new n.Audio(this.listener),this.analyser=new n.AudioAnalyser(this.sound,t.fftsize||256),this.frequencyBinCount=this.analyser.analyser.frequencyBinCount}return t.prototype.load=function(t){var e=t.src,r=document.getElementById("__AzusaAudio")||document.createElement("audio");r.id="__AzusaAudio",r.src=e,r.style.display="none",!document.getElementById("__AzusaAudio")&&document.body.appendChild(r),this.sound.setMediaElementSource(r),this.audioElement=r},t.prototype.getFrequencyData=function(){return this.analyser.getFrequencyData()},t}(),l=Object.assign(n,{});l.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new l.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},l.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},l.EffectComposer=function(t,e){if(this.renderer=t,void 0===e){var r={minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBAFormat,stencilBuffer:!1},i=t.getSize();(e=new l.WebGLRenderTarget(i.width,i.height,r)).texture.name="EffectComposer.rt1"}this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===l.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new l.ShaderPass(l.CopyShader)},Object.assign(l.EffectComposer.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t);var e=this.renderer.getSize();t.setSize(e.width,e.height)},insertPass:function(t,e){this.passes.splice(e,0,t)},render:function(t){var e,r,i=!1,n=this.passes.length;for(r=0;r<n;r++)if(!1!==(e=this.passes[r]).enabled){if(e.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),e.needsSwap){if(i){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==l.MaskPass&&(e instanceof l.MaskPass?i=!0:e instanceof l.ClearMaskPass&&(i=!1))}},reset:function(t){if(void 0===t){var e=this.renderer.getSize();(t=this.renderTarget1.clone()).setSize(e.width,e.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this.renderTarget1.setSize(t,e),this.renderTarget2.setSize(t,e);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(t,e)}}),l.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(l.Pass.prototype,{setSize:function(t,e){},render:function(t,e,r,i,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),l.RenderPass=function(t,e,r,i,n){l.Pass.call(this),this.scene=t,this.camera=e,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==n?n:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},l.RenderPass.prototype=Object.assign(Object.create(l.Pass.prototype),{constructor:l.RenderPass,render:function(t,e,r,i,n){var o,a,s=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(o=t.getClearColor().getHex(),a=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),this.clearColor&&t.setClearColor(o,a),this.scene.overrideMaterial=null,t.autoClear=s}}),l.ShaderPass=function(t,e){l.Pass.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof l.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=l.UniformsUtils.clone(t.uniforms),this.material=new l.ShaderMaterial({defines:t.defines||{},uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.camera=new l.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new l.Scene,this.quad=new l.Mesh(new l.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},l.ShaderPass.prototype=Object.assign(Object.create(l.Pass.prototype),{constructor:l.ShaderPass,render:function(t,e,r,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}}),l.UnrealBloomPass=function(t,e,r,i){l.Pass.call(this),this.strength=void 0!==e?e:1,this.radius=r,this.threshold=i,this.resolution=void 0!==t?new l.Vector2(t.x,t.y):new l.Vector2(256,256);var n={minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new l.WebGLRenderTarget(o,a,n),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var u;(u=new l.WebGLRenderTarget(o,a,n)).texture.name="UnrealBloomPass.h"+s,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u),(u=new l.WebGLRenderTarget(o,a,n)).texture.name="UnrealBloomPass.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),o=Math.round(o/2),a=Math.round(a/2)}void 0===l.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var c=l.LuminosityHighPassShader;this.highPassUniforms=l.UniformsUtils.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new l.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new l.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===l.CopyShader&&console.error("THREE.BloomPass relies on THREE.CopyShader");var f=l.CopyShader;this.copyUniforms=l.UniformsUtils.clone(f.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new l.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,blending:l.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new l.Color,this.oldClearAlpha=1,this.camera=new l.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new l.Scene,this.quad=new l.Mesh(new l.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},l.UnrealBloomPass.prototype=Object.assign(Object.create(l.Pass.prototype),{constructor:l.UnrealBloomPass,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length();t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length();t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var r=Math.round(t/2),i=Math.round(e/2);this.renderTargetBright.setSize(r,i);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(r,i),this.renderTargetsVertical[n].setSize(r,i),this.separableBlurMaterials[n].uniforms.texSize.value=new l.Vector2(r,i),r=Math.round(r/2),i=Math.round(i/2)},render:function(t,e,r,i,n){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.setClearColor(new l.Color(0,0,0),0),n&&t.context.disable(t.context.STENCIL_TEST),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,t.render(this.scene,this.camera,this.renderTargetBright,!0);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=l.UnrealBloomPass.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetsHorizontal[s],!0),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=l.UnrealBloomPass.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetsVertical[s],!0),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,r,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getSeperableBlurMaterial:function(t){return new l.ShaderMaterial({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new l.Vector2(.5,.5)},direction:{value:new l.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new l.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t \t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),l.UnrealBloomPass.BlurDirectionX=new l.Vector2(1,0),l.UnrealBloomPass.BlurDirectionY=new l.Vector2(0,1),r.d(e,"Azusa",function(){return f});var c=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),h=function(t){function e(r,i){var n=new l.BufferGeometry;return n.addAttribute("position",e.creatBufferAttribute(r).setDynamic(!0)),t.call(this,n,i)||this}return c(e,t),e.creatBufferAttribute=function(t){var e=[];return(t=t.concat(t[0])).forEach(function(t){e.push(t.x,t.y,0)}),new l.BufferAttribute(new Float32Array(e),3)},e}(l.Line),f=function(){return function(t){var e=this;this.clock=new l.Clock,this.material=new l.MeshBasicMaterial({color:240116}),this.lineMaterial=new l.LineBasicMaterial({color:240116}),this.scale=1,this.Triangles=[],this.loadLine=function(t){var r=e.lineMaterial;return{lineA:new h(t.map(function(t){return t.positionA}),r),lineB:new h(t.map(function(t){return t.positionB}),r),lines:a(0,t.length).map(function(e){return new h([t[e].positionA,t[e].positionB],r)})}},this.loadAudio=function(t,e){t.add(e.listener)},this.loadTriangle=function(){var t=new l.Group;return setInterval(function(){return requestAnimationFrame(e.addTriangle)},500),{TriangleGroup:t}},this.addTriangle=function(){var t=e.material,r=e.lineMaterial,i=e.makeTriangle(t,r,function(t){e.Triangles=e.Triangles.filter(function(e){return e!==t}),e.TriangleGroup.remove(t.group)});e.TriangleGroup.add(i.group),e.Triangles.push(i)},this.makeTriangle=function(t,e,r){return void 0===t&&(t=new l.MeshBasicMaterial({color:240116})),void 0===e&&(e=new l.LineBasicMaterial({color:240116})),new o(2,new l.Vector3(0,0,0),360*Math.random(),i(5,1),i(.1,.02),t,e,{startShow:15,endShow:30,startHide:60,endHide:70},r)},this.updateGeometries=function(){if(e.nodes){e.lineGroup.scale.set(e.scale,e.scale,e.scale);var t=e.lineA.geometry.getAttribute("position"),r=e.lineB.geometry.getAttribute("position"),i=e.nodes.map(function(t){return[t.positionA,t.positionB]});i.forEach(function(i,n){t.set([i[0].x,i[0].y],3*n),r.set([i[1].x,i[1].y],3*n);var o=e.lines[n].geometry.getAttribute("position");o.set([i[0].x,i[0].y,0,i[1].x,i[1].y,0],0),o.needsUpdate=!0}),t.set([t.array[0],t.array[1]],3*i.length),r.set([r.array[0],r.array[1]],3*i.length),t.needsUpdate=!0,r.needsUpdate=!0}},this.render=function(){e.composer.render();var t=e.audio.getFrequencyData(),r=e.clock.getDelta(),i=t.slice(e.option.cutFront,t.length-e.option.cutEnd);e.nodes.forEach(function(t,e,n){t.strength=.1*i[e%n.length],t.transition(r)}),e.scale=1+t[Math.ceil(.05*t.length)]/1e3,e.updateGeometries(),e.Triangles.forEach(function(t){return t.transition(r)}),requestAnimationFrame(e.render)},this.loadGui=function(){var t={projection:"normal",background:!1,exposure:1,bloomStrength:1.5,bloomThreshold:.2,bloomRadius:0},r=new window.dat.GUI;r.add(t,"exposure",.1,2),r.add(t,"bloomThreshold",0,1).onChange(function(t){e.bloomPass.threshold=Number(t)}),r.add(t,"bloomStrength",0,3).onChange(function(t){e.bloomPass.strength=Number(t)}),r.add(t,"bloomRadius",0,1).onChange(function(t){e.bloomPass.radius=Number(t)}),r.open()},this.resize=function(t,r){e.camera.aspect=t/r,e.camera.fov=t<=425?70:45,e.camera.updateProjectionMatrix(),e.renderer.setSize(t,r),e.composer.setSize(t,r)},this.getAudioElement=function(){return e.audio.audioElement},this.loadMusic=function(){e.option.music&&e.audio.load(e.option.music)};var r=Object.assign({width:window.innerWidth,height:window.innerHeight,subdivisionSize:1024,cutFront:0,cutEnd:0},t),n=r.view,c=r.width,f=void 0===c?window.innerWidth:c,d=r.height,p=void 0===d?window.innerHeight:d,m=r.subdivisionSize,v=void 0===m?1024:m,g=r.cutFront,y=void 0===g?0:g,x=r.cutEnd,b=void 0===x?0:x,S=new l.WebGLRenderer({canvas:n,alpha:!0,antialias:!0});S.setSize(f,p);var w=new l.Scene,T=new l.PerspectiveCamera(45,f/p,1,500);T.position.set(0,0,100),T.lookAt(new l.Vector3(0,0,0));var M=new l.EffectComposer(S);M.setSize(f,p);var P=new l.RenderPass(w,T);M.addPass(P),this.bloomPass=new l.UnrealBloomPass(new l.Vector2(window.innerWidth,window.innerHeight),1.5,.2,0),M.addPass(this.bloomPass);var C=new l.ShaderPass(l.CopyShader);C.renderToScreen=!0,M.addPass(C);var B=new u({fftsize:v});this.loadAudio(T,B);var _=B.frequencyBinCount-b-y,O=a(0,_).map(function(t){return new s(20,(t/_*360+45)%360,new l.Vector2(0,0))}),E=new l.Group,A=this.loadLine(O),U=A.lineA,j=A.lineB,D=A.lines;E.add(U),E.add(j),D.forEach(function(t){return E.add(t)}),w.add(E);var F=this.loadTriangle().TriangleGroup;w.add(F),this.audio=B,this.renderer=S,this.composer=M,this.camera=T,this.nodes=O,this.lineA=U,this.lineB=j,this.lines=D,this.TriangleGroup=F,this.lineGroup=E,this.option=r,this.loadMusic(),this.render(),this.resize(f,p)}}();e.default=f}])});
//# sourceMappingURL=azusa.min.js.map